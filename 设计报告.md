# 设计报告
## 软件工程 - 思维导图项目
***

***
## 项目定位

基于Web的、可多人在线协作编辑的、思维导图系统

***
## 工程结构

项目采用`前后端分离`的开发技术，基于`Docker`部署。由此，分出3个主要分支：
|分支|描述|职责|
|--|--|--|
|browser|前端分支|负责前端界面的数据绑定、功能逻辑和用户交互|
|server|后端分支|负责后端数据持久化、用户管理和提供restful接口|
|master|部署主干|成型的模块将并入该分支，负责Docker层的管理|

另设若干类机动的辅助分支：
|类型|描述|职责|
|--|--|--|
|develop|开发分支|单独用来开发过程中的某些独立的复杂模块，开发成功后并入原分支|
|doc|文档分支|管理开发文档、项目说明等等内容|
|member|成员分支|其它成员自行管理的分支|

***
## 基础设计

将`思维导图`抽象成由描述绘图的语句构成的`文本`，每条语句视为一则`绘图指令`，作为一种消息传递。

简单借鉴`弱联网大厅模式游戏`的同步策略，浏览器端不主动绘图，必须`由后端发起`绘制指令。

一个思维导图项目视作`一个房间`，用户的绘图操作必须`经由后端转发`，房间里所有保持连接的`用户浏览器端`接到指令后再做运算呈现。

***
## 技术细节

### 项目管理
整个项目托管在`GitHub`上，借助`Git`进行团队协作、版本管理、Bug反馈。

### 开发环境
主要IDE为`VSCode`，辅助IDE为`Coding.net`的云端`WebIDE`。开发用操作系统不限，根据前|后|部署3端不同需求，分别需搭建相应环境。后端为`Python:flask & socketio`；前端：`React:dva + ant design`；部署：`Docker:Alpine Linux`环境。

### 容器化部署
自己以前写的基于`Docker`的`Alpine Linux`的`flask`镜像。使用`Daocloud`实现云端集群的自动化部署和持续集成，集群节点在自己的`阿里云VPS`上。

### 数据持久化
基于`python-sqlalchemy`框架做ORM，数据库可动态选择更换。目前开发时使用`Sqlite3`，Python内建驱动；部署将换用`MariaDB`，用`PyMySql`做驱动。

### Web长连接
用户浏览器与后端服务器基于`SocketIO`实现长连接，`SocketIO`本身是多个协议的分装，这里主要是利用H5的`WebSocket`协议。

### 项目架构
后端放弃传统的MVC结构，不做模板预处理和渲染，只提供`Restful API`服务。前端放弃传统的`H5+CSS+JS+Ajax`结构，选择基于`React`和`Redux`的`dva`框架，结合`Ant designed`进行前端模块化开发。

### 同步原理
后端不保存任何`状态`，而是对所有`操作`进行备录，当前思维导图的状态应当能够由所有备录运算产生。但用户可以选择对当前状态生成`快照`，从而产出一份干净的、没有冗余指令的备忘录。
